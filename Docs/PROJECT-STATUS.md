# Project Status

## Current Version: 0.3.0

## Phase Completion

| Phase | Description | Status | Notes |
|-------|-------------|--------|-------|
| 1 | Project setup + Swiss Ephemeris integration | Done | Vendored from github.com/aloistr/swisseph |
| 2 | Tithi calculation + sunrise | Done | Bisection-based boundary finding |
| 3 | Month (masa) determination | Done | Amanta scheme, adhika detection working |
| 4 | Full month panchang CLI | Done | Single-day and full-month views |
| 5 | Validation against drikpanchang.com | Done | 186 dates verified against drikpanchang.com |
| 6 | Validation web page | Done | Month-by-month visual comparison tool |
| 7 | Reingold diff overlay | Done | HL diffs shown on web page (89.2% match) |
| 8 | Hindu solar calendars | Done | Tamil, Bengali, Odia, Malayalam — all verified against drikpanchang.com |

## Test Results

22,432 assertions passing across 7 test suites:

| Suite | Assertions | What it tests |
|-------|------------|---------------|
| test_astro | 11 | JD conversion, day-of-week, solar longitude, ayanamsa, sunrise |
| test_tithi | 18 | Tithi at known dates, kshaya/adhika detection, lunar phase |
| test_masa | 24 | Month name, adhika months, solar rashi, Saka/Vikram years |
| test_validation | 744 | **External validation**: 186 dates verified against drikpanchang.com x 4 checks |
| test_csv_regression | 4,416 | **Regression**: 1,104 sampled days from generated CSV (1900-2050) x 4 checks |
| test_adhika_kshaya | 17,076 | **Regression**: all 4,269 adhika/kshaya tithi edge-case days (1900-2050) x 4 checks |
| test_solar | 143 | **Solar calendars**: 33 dates across 4 regional variants + roundtrip + sankranti precision + month/era names |

## Validated Against drikpanchang.com

186 dates spanning 1900-2050 verified against drikpanchang.com day-panchang pages:

- **54 general dates** (1950-2045): hand-picked covering month boundaries, adhika months, year transitions
- **132 adhika/kshaya tithi edge-case dates** (1900-2050): batch-verified in 5 rounds, including 52 adhika tithi dates and 80 kshaya tithi dates
- Tithi at sunrise: 100% match (186/186)
- Month (masa) name: 100% match (186/186)
- Adhika month detection: 100% match (tested 1993, 2004, 2007, 2012, 2015, 2018, 2020, 2023, 2039, 2050)
- Saka year: 100% match (186/186)
- Sunrise time: within ~1 minute of drikpanchang.com (Moshier ephemeris vs Swiss files)

## Regression Tests

A 55,152-day CSV (`ref_1900_2050.csv`) was generated by our calculator for 1900-2050. Two regression test suites verify self-consistency against this CSV — they catch unintended changes from code modifications but are **not** independently validated against an external source. The 186 spot-checked dates above give confidence the underlying data is correct.

## Validation Web Page

A browser-based tool for manual month-by-month comparison against drikpanchang.com, covering all 1,812 months from 1900 to 2050.

- **Server**: `bash validation/web/serve.sh` → http://localhost:8081 (no-cache headers)
- **Layout**: Transposed calendar grid (rows = days of week, columns = weeks), matching drikpanchang.com
- **Reingold overlay**: Orange-highlighted cells where Reingold/Dershowitz (Surya Siddhanta, `hindu-lunar-from-fixed`) disagrees with our Drik Siddhanta calculation
  - 5,943 of 55,152 days differ (89.2% match rate)
  - Toggle on/off via "R/D overlay" checkbox in header
- **Data pipeline**: `python3 tools/csv_to_json.py` regenerates all JSON from `ref_1900_2050.csv` + `reingold_1900_2050.csv`

## Solar Calendar Validation

143 assertions across 4 regional solar calendar variants, all verified against drikpanchang.com:

- **Tamil** (10 dates): Sankranti boundaries, mid-month, year transitions (Saka era)
- **Bengali** (9 dates): Midnight + 24min edge case, Boishakh 1 boundary (Bangabda era)
- **Odia** (7 dates): End-of-civil-day critical time, Baisakha 1 boundary (Saka era)
- **Malayalam** (7 dates): Apparent noon critical time, Chingam 1 boundary, Kollam era
- Roundtrip tests: `gregorian_to_solar()` → `solar_to_gregorian()` for all 33 dates
- Sankranti precision: Mesha Sankranti 2025 longitude error < 0.0001°
- Month names and era names verified for all 4 calendars

## Known Limitations

- Uses Moshier ephemeris (built-in, ~1 arcminute precision) instead of Swiss Ephemeris data files (~0.001 arcsecond)
- Amanta scheme only (no Purnimanta support)
- No nakshatra, yoga, or karana calculations
- No kshaya masa detection (extremely rare edge case)
- UTC offset is manual (no IANA timezone / DST support)
- Location defaults to New Delhi; no city database
- Solar calendars validated with spot-checks (143 assertions); no bulk regression CSV yet

## Source Statistics

- Application code: ~1,290 lines across 16 files (8 .c + 8 .h)
- Test code: ~1,250 lines across 7 files
- Vendored Swiss Ephemeris: ~34,600 lines (11 .c + 12 .h)
